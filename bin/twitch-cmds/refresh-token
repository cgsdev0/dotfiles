#!/usr/bin/env bash

set -eu

source $HOME/.twitch_secrets "$1"

RESPONSE=$(curl -Ss -X POST "https://id.twitch.tv/oauth2/token" \
    -F "client_id=${TWITCH_CLIENT_ID}" \
    -F "refresh_token=${TWITCH_REFRESH_TOKEN}" \
    -F "client_secret=${TWITCH_CLIENT_SECRET}" \
    -F 'grant_type=refresh_token' )

TWITCH_REFRESH_TOKEN=$(echo "$RESPONSE" | jq -r '.refresh_token')
TWITCH_ACCESS_TOKEN=$(echo "$RESPONSE" | jq -r '.access_token')

if [[ "$TWITCH_ACCESS_TOKEN" != "null" ]]; then
  echo "$TWITCH_ACCESS_TOKEN" > ~/.secrets/twitch/$1/access
fi
if [[ "$TWITCH_REFRESH_TOKEN" != "null" ]]; then
  echo "$TWITCH_REFRESH_TOKEN" > ~/.secrets/twitch/$1/refresh
fi
